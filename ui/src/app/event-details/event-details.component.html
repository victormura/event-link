<section *ngIf="event" class="card details" [attr.aria-busy]="loading">
  <img
    [src]="event.cover_url || placeholderCover"
    alt="cover image"
    class="cover"
    (error)="onCoverError()"
  />
  <div class="header">
    <div>
      <p class="muted">{{ event.category }}</p>
      <h1>{{ event.title }}</h1>
      <div class="meta">
        <span>{{ event.start_time | date: 'fullDate' }} Â· {{ event.start_time | date: 'shortTime' }}<span *ngIf="event.end_time"> - {{ event.end_time | date: 'shortTime' }}</span></span>
        <span>{{ event.location }}</span>
        <span>Organizator: <a [routerLink]="['/organizers', event.owner_id]">{{ event.owner_name || 'Organizator' }}</a></span>
      </div>
    </div>
    <div class="actions">
      <button *ngIf="!auth.isLoggedIn()" class="btn primary" (click)="register()" [disabled]="actionLoading">{{ 'details.loginToRegister' | translate }}</button>
      <button *ngIf="canRegister()" class="btn primary" (click)="register()" [disabled]="actionLoading">{{ actionLoading ? ('details.processing' | translate) : ('details.register' | translate) }}</button>
      <button *ngIf="auth.isStudent() && event.is_registered" class="btn ghost" type="button" (click)="unregister()" [disabled]="actionLoading">{{ actionLoading ? ('details.processing' | translate) : ('details.unregister' | translate) }}</button>
      <button
        *ngIf="!canRegister() && !event.is_registered && (event.available_seats !== null && event.available_seats !== undefined && event.available_seats <= 0)"
        class="btn ghost"
        disabled
      >
        {{ 'details.full' | translate }}
      </button>
      <button *ngIf="auth.isLoggedIn() && !auth.isStudent() && !event.is_owner" class="btn ghost" disabled>
        {{ 'details.studentsOnly' | translate }}
      </button>
      <button *ngIf="auth.isStudent()" class="btn ghost" type="button" (click)="toggleFavorite()" [disabled]="actionLoading">
        {{ event.is_favorite ? ('favorites.remove' | translate) : ('favorites.add' | translate) }}
      </button>
      <div class="owner-actions" *ngIf="auth.isOrganizer() && event.is_owner">
        <a class="btn ghost" [routerLink]="['/events', event.id, 'edit']">{{ 'details.edit' | translate }}</a>
        <a class="btn ghost" [routerLink]="['/organizer/events', event.id, 'participants']">{{ 'details.participants' | translate }}</a>
        <button class="btn danger" (click)="deleteEvent()">{{ 'details.delete' | translate }}</button>
        <a class="btn ghost" [href]="icsLink(event.id)">{{ 'details.ics' | translate }}</a>
      </div>
    </div>
  </div>

  <div class="stats">
    <div class="stat-box">
      <div class="label">{{ 'details.seatsTaken' | translate }}</div>
      <div class="value">{{ event.seats_taken }} / {{ event.max_seats }}</div>
    </div>
    <div class="stat-box" *ngIf="event.available_seats !== null && event.available_seats !== undefined">
      <div class="label">{{ 'details.seatsLeft' | translate }}</div>
      <div class="value">{{ event.available_seats }}</div>
    </div>
  </div>

  <div class="chips">
    <span class="tag-chip" *ngFor="let tag of event.tags">{{ tag.name }}</span>
  </div>

  <p class="description">{{ event.description }}</p>
</section>

<div *ngIf="loading" class="empty-state" aria-live="polite">
  <span class="spinner" aria-hidden="true"></span> {{ 'details.loading' | translate }}
</div>
<div *ngIf="successMessage" class="success" aria-live="polite">{{ successMessage }}</div>
<div *ngIf="error && !loading" class="error" aria-live="assertive">{{ error }}</div>
